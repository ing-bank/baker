package com.ing.baker.baas.interaction

import com.ing.baker.runtime.scaladsl.InteractionInstance
import scala.concurrent.ExecutionContext.Implicits.global

/**
 * Expects single argument containing comma-separated list of interactions' entry points
 */
object Main extends App {
  private def runApp(classNames: String): Unit =
    try {
      val interactions: List[String] = classNames.split(",").toList
      val implementations = interactions
        .map(entryClassName => Class.forName(entryClassName).getConstructor().newInstance().asInstanceOf[AnyRef])
        .map(implementation => InteractionInstance.unsafeFrom(implementation))
      RemoteInteractionLoader.apply(implementations)
    } catch {
      case ex: Exception =>
        throw new IllegalStateException(s"Unable to initialize the classes $classNames", ex)
    }

  args.headOption.map(runApp).getOrElse(throw new IllegalAccessException("Please provide comma-separated class names as a parameter"))
}