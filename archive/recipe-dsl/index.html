
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Recipe DSL - Baker</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/ing.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recipe-dsl" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Baker" class="md-header__button md-logo" aria-label="Baker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Baker
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recipe DSL
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ing-bank/baker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Baker" class="md-nav__button md-logo" aria-label="Baker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Baker
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ing-bank/baker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/quickstart-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cookbook
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Cookbook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/recipe-dsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recipe DSL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/error-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/fire-sensory-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fire events and inquiry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/interaction-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interaction execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/cookbook/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/reference/main-abstractions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Abstractions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/reference/execution-semantics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution Semantics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/reference/baker-types-and-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Baker Types and Values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/reference/runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Baker Runtime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/reference/stores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event Stores and Cluster Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Versions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Versions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/versions/baker-3-release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes v3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/versions/baker-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration Guide v3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/versions/baker-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migration Guide v2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sections/feature-comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature comparison
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sensory-events" class="md-nav__link">
    <span class="md-ellipsis">
      Sensory events
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensory events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#firing-limit" class="md-nav__link">
    <span class="md-ellipsis">
      Firing limit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactions" class="md-nav__link">
    <span class="md-ellipsis">
      Interactions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#maximum-interaction-count" class="md-nav__link">
    <span class="md-ellipsis">
      Maximum interaction count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predefining-ingredients" class="md-nav__link">
    <span class="md-ellipsis">
      Predefining ingredients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-renames" class="md-nav__link">
    <span class="md-ellipsis">
      Event renames
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Event requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interaction-failure-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Interaction Failure strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Interaction Failure strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-interaction" class="md-nav__link">
    <span class="md-ellipsis">
      Block interaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fire-event" class="md-nav__link">
    <span class="md-ellipsis">
      Fire event
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-with-incremental-backoff" class="md-nav__link">
    <span class="md-ellipsis">
      Retry with incremental backoff
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#default-failure-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Default failure strategy
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="recipe-dsl">Recipe DSL</h1>
<p>The recipe DSL allows you to declaritively describe your process.</p>
<p>Let's start with the <a href="../#visual-representation">web shop</a> recipe as an example.</p>
<p>The complete code example can be found <a href="https://github.com/ing-bank/baker/blob/master/runtime/src/test/java/com/ing/baker/Webshop.java">here</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">final</span><span class="w"> </span><span class="n">Recipe</span><span class="w"> </span><span class="n">webshopRecipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Recipe</span><span class="p">(</span><span class="s">&quot;webshop&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">withSensoryEvents</span><span class="p">(</span>
<span class="w">        </span><span class="n">OrderPlaced</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">        </span><span class="n">CustomerInfoReceived</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
<span class="w">        </span><span class="n">PaymentMade</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">ValidateOrder</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">ManufactureGoods</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withRequiredEvents</span><span class="p">(</span><span class="n">PaymentMade</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">ValidateOrder</span><span class="p">.</span><span class="na">Valid</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">SendInvoice</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">withRequiredEvents</span><span class="p">(</span><span class="n">ShipGoods</span><span class="p">.</span><span class="na">GoodsShipped</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">ShipGoods</span><span class="p">.</span><span class="na">class</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="na">withDefaultFailureStrategy</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">RetryWithIncrementalBackoffBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">withInitialDelay</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDeadline</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofHours</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">withMaxTimeBetweenRetries</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</code></pre></div>
<h2 id="sensory-events">Sensory events</h2>
<p><a href="../concepts/#event">Events</a> are simple <code>POJO</code> classes. For example:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Scala</label><label for="__tabbed_1_2">Java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">case</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomerInfoReceived</span><span class="p">(</span><span class="n">customerInfo</span><span class="p">:</span><span class="w"> </span><span class="nc">CustomerInfo</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CustomerInfoReceived</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CustomerInfo</span><span class="w"> </span><span class="n">customerInfo</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">CustomerInfoReceived</span><span class="p">(</span><span class="n">CustomerInfo</span><span class="w"> </span><span class="n">customerInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">customerInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerInfo</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>The field types of the <code>POJO</code> class must be compatible with the Baker type system.</p>
<p>See the <a href="../type-system/#default-supported-types">supported types</a> for more information.</p>
<p>The names of the fields are obtained using java reflection.</p>
<p>They can be added using the <code>.withSensoryEvents(..)</code> method.</p>
<h3 id="firing-limit">Firing limit</h3>
<p>A <em>firing limit</em> is a limit on the number of times a sensory event may be received by a <a href="../dictionary/#process-instance">process instance</a>.</p>
<p>By default sensory events have a firing limit of <code>1</code> per process instance.</p>
<p>This means the event will be rejected with status <code>FiringLimitMet</code> after the first time it is received.</p>
<p>If you want to send an event more then once you may add it like this:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="p">.</span><span class="na">withSensoryEventsNoFiringLimit</span><span class="p">(</span><span class="n">CustomerInfoReceived</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</code></pre></div>
<p>In this example the <code>CustomerInfoReceived</code> can now be received multiple times by a process instance.</p>
<h2 id="interactions">Interactions</h2>
<p>Interactions are interfaces with some requirements. See <a href="../interactions/">here</a> how to define them.</p>
<p>You can include interactions in your recipe using the static <code>of(..)</code> method.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import static</span><span class="w"> </span><span class="nn">com.ing.baker.recipe.javadsl.InteractionDescriptor.of</span><span class="p">;</span>

<span class="kd">final</span><span class="w"> </span><span class="n">Recipe</span><span class="w"> </span><span class="n">webshopRecipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Recipe</span><span class="p">(</span><span class="s">&quot;webshop&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">ValidateOrder</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
</code></pre></div>
<p>There are a number of options to tailor an interaction for your recipe.</p>
<h3 id="maximum-interaction-count">Maximum interaction count</h3>
<p>By default there is <em>no</em> limit on the number of times an Interaction may fire.</p>
<p>Sometimes you may want to set a limit.</p>
<p>For example, to ensure the goods are shipped only once.</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">        </span><span class="n">of</span><span class="p">(</span><span class="n">ShipGoods</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">withMaximumInteractionCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">     </span><span class="p">)</span>
</code></pre></div>
<h3 id="predefining-ingredients">Predefining ingredients</h3>
<p>An interaction normally requires all its input ingredients to be provided from <a href="../concepts/#event">Events</a>.</p>
<p>Sometimes however it is useful to <em>predefine</em> (or <em>hard code</em>) the value of an ingredient.</p>
<p>For example:</p>
<ul>
<li>An email template</li>
<li>An application/requester id when calling an external system</li>
</ul>
<p>This can be done by:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">SendEmail</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="na">withPredefinedIngredient</span><span class="p">(</span><span class="s">&quot;emailTemplate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Welcome to ING!&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
</code></pre></div>
<p>Note that <em>predefined</em> ingredients are <strong>always</strong> available and do not have to be provided by an event for each interaction call.</p>
<p>Each time all <em>remaining</em> ingredients are provided, the interaction will fire.</p>
<p>You can <strong>not</strong> predefine <em>ALL</em> input ingredients of an interaction.</p>
<h3 id="event-renames">Event renames</h3>
<p>Sometimes it useful to rename an interaction event and/or its ingredients to fit better in the context of your recipe.</p>
<p>For example, to rename the <code>GoodsManufactured</code> event and its ingredient.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">ManufactureGoods</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="na">withEventTransformation</span><span class="p">(</span>
<span class="w">        </span><span class="n">GoodsManufactured</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ManufacturingDone&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ImmutableMap</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;goods&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;manufacturedGoods&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
</code></pre></div>
<h3 id="event-requirements">Event requirements</h3>
<p>As mentioned before, the DSL is declarative, you do not have to think about order. This is implicit in the data requirements of the interactions.</p>
<p>However, sometimes data requirements are not enough.</p>
<p>For example, you might want to be sure to only send an invoice (<code>SendInvoice</code>) <em>AFTER</em> the goods where shipped (<code>GoodsShipped</code>).</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">SendInvoice</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withRequiredEvents</span><span class="p">(</span><span class="n">ShipGoods</span><span class="p">.</span><span class="na">GoodsShipped</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</code></pre></div>
<p>In this case the <code>GoodsShipped</code> event <em>MUST</em> happen before the interaction may execute.</p>
<p>You can specify multiple events in a single clause. These are bundled with an <code>AND</code> condition, meaning <em>ALL</em> events in the clause are required.</p>
<p>You can also require a single event from a number of options.</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">SendInvoice</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withRequiredOneOfEvents</span><span class="p">(</span><span class="n">EventA</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">EventB</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
</code></pre></div>
<p>In this case the interaction may fire if <em>either</em> <code>EventA</code> OR <code>EventB</code> has occured.</p>
<h3 id="interaction-failure-strategy">Interaction Failure strategy</h3>
<p>When an interaction throws an exception there are a number of mitigation strategies:</p>
<h4 id="block-interaction">Block interaction</h4>
<p>This is the <em>DEFAULT</em> strategy if no other is defined and no <a href="#default-failure-strategy">default strategy</a> is defined.</p>
<p>This option is suitable for non idempotent interactions that cannot be retried.</p>
<p>When an exception is thrown from the interaction the interaction is <em>blocked</em>.</p>
<p>This means that the interaction cannot execute again automatically.</p>
<p>It requires <a href="../process-execution/#incident-resolving">manual intervening</a> to continue the process from then on.</p>
<h4 id="fire-event">Fire event</h4>
<p>This option is analagous to a <code>try { } catch { }</code> in code. When an exception is raised from the interaction you specify an
event to fire. So instead of failing the process continues.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">ValidateOrder</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">withInteractionFailureStrategy</span><span class="p">(</span>
<span class="w">       </span><span class="n">InteractionFailureStrategy</span><span class="p">.</span><span class="na">FireEvent</span><span class="p">(</span><span class="s">&quot;ValidateOrderFailed&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="p">)</span>
<span class="w">   </span><span class="p">)</span>
</code></pre></div>
<h4 id="retry-with-incremental-backoff">Retry with incremental backoff</h4>
<p>Incremental backoff allows you to configure a retry mechanism that takes longer for each retry.
The idea here is that you quickly retry at first but slower over time. To not overload your system but give it time to recover.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p">.</span><span class="na">withInteractions</span><span class="p">(</span>
<span class="w">    </span><span class="n">of</span><span class="p">(</span><span class="n">ValidateOrder</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="na">withFailureStrategy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RetryWithIncrementalBackoffBuilder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">withInitialDelay</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">withBackoffFactor</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">withMaxTimeBetweenRetries</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofSeconds</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">withDeadline</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofHours</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">build</span><span class="p">())</span>
<span class="w">  </span><span class="p">)</span>
</code></pre></div>
<p>What do these parameters mean?</p>
<table>
<thead>
<tr>
<th>name</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>initialDelay</code></td>
<td>The delay for the first retry.</td>
</tr>
<tr>
<td><code>backoffFactor</code></td>
<td>The backoff factor for the delay (optional, <code>default = 2</code>)</td>
</tr>
<tr>
<td><code>maxTimeBetweenRetries</code></td>
<td>The maximum interval between retries.</td>
</tr>
<tr>
<td><code>deadLine</code></td>
<td>The maximum total amount of time spend delaying.</td>
</tr>
</tbody>
</table>
<p>For our example this results in the following delay pattern:</p>
<p><code>100 millis</code> -&gt; <code>200 millis</code> -&gt; <code>400 millis</code> -&gt; <code>...</code> -&gt;  <code>100 seconds</code> -&gt; <code>100 seconds</code></p>
<p>Which can be visualized like this:</p>
<p><img alt="" src="/images/incremental-backoff.png" /></p>
<p>Note that these delays do <strong>not</strong> include interaction execution time.</p>
<p>For example, if the first retry execution takes <code>5</code> seconds (and fails again) then the second retry will
be triggered after (from the start):</p>
<p><code>(100 millis + 5 seconds + 200 millis) = 5.3 seconds</code></p>
<p>This also means that the <code>24 hour</code> deadline <strong>does not</strong> include interaction execution time. It is advisable to take this
into account when coming up with this number.</p>
<p><strong>Retry exhaustion</strong></p>
<p>It can happen that after some time, when an interaction keeps failing, that the retry is exhausted.</p>
<p>When this happens 2 things may happen.</p>
<p>Either the interaction becomes [blocked(#blocked-interaction).</p>
<p>Or if you configure so, the process continues with a predefined event:</p>
<div class="highlight"><pre><span></span><code>.withFailureStrategy(new RetryWithIncrementalBackoffBuilder()
  .withFireRetryExhaustedEvent(SomeEvent.class))
</code></pre></div>
<p>Note that this event class <strong>requires</strong> an empty constructor to be present and <strong>cannot</strong> provide ingredients.</p>
<h2 id="default-failure-strategy">Default failure strategy</h2>
<p>You can also define a default failure strategy on the recipe level.</p>
<p>This then serves as a fallback if none is defined for an interaction.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="kd">final</span><span class="w"> </span><span class="n">Recipe</span><span class="w"> </span><span class="n">webshopRecipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Recipe</span><span class="p">(</span><span class="s">&quot;webshop&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">withDefaultFailureStrategy</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">RetryWithIncrementalBackoffBuilder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">withInitialDelay</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMillis</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">withDeadline</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofHours</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">withMaxTimeBetweenRetries</span><span class="p">(</span><span class="n">Duration</span><span class="p">.</span><span class="na">ofMinutes</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>