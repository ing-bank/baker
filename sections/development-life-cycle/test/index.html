



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Test - Baker</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/ing.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#test" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Baker" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Baker
            </span>
            <span class="md-header-nav__topic">
              
                Test
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Baker" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Baker
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Development Life Cycle
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Development Life Cycle
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../design-a-recipe/" title="Design a Recipe" class="md-nav__link">
      Design a Recipe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../use-visualizations/" title="Use Visualizations" class="md-nav__link">
      Use Visualizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../implement-interactions/" title="Implement Interactions" class="md-nav__link">
      Implement Interactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bake-fire-events-and-inquiry/" title="Bake, Fire Events and Inquiry" class="md-nav__link">
      Bake, Fire Events and Inquiry
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Test
      </label>
    
    <a href="./" title="Test" class="md-nav__link md-nav__link--active">
      Test
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-soundness-compiling-the-recipe-in-a-test" title="Testing Recipes for Soundness: Compiling the Recipe in a Test" class="md-nav__link">
    Testing Recipes for Soundness: Compiling the Recipe in a Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-correctness-mocking-interaction-implementations" title="Testing Recipes for Correctness: Mocking Interaction Implementations" class="md-nav__link">
    Testing Recipes for Correctness: Mocking Interaction Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-interaction-implementations-with-mockito" title="Mocking Interaction Implementations with Mockito" class="md-nav__link">
    Mocking Interaction Implementations with Mockito
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-individual-implementations" title="Testing Individual Implementations" class="md-nav__link">
    Testing Individual Implementations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configure/" title="Configure" class="md-nav__link">
      Configure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitor/" title="Monitor" class="md-nav__link">
      Monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resolve-failed-recipe-instances/" title="Resolve Failed Recipes" class="md-nav__link">
      Resolve Failed Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/main-abstractions/" title="Main Abstractions" class="md-nav__link">
      Main Abstractions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/execution-semantics/" title="Execution Semantics" class="md-nav__link">
      Execution Semantics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/baker-types-and-values/" title="Baker Types and Values" class="md-nav__link">
      Baker Types and Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/dsls/" title="Recipe DSLs" class="md-nav__link">
      Recipe DSLs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/runtime/" title="The Akka Based Runtime" class="md-nav__link">
      The Akka Based Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/event-listener/" title="Event Listener" class="md-nav__link">
      Event Listener
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/stores/" title="Event Stores and Cluster Configuration" class="md-nav__link">
      Event Stores and Cluster Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Versions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Versions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-3-release-notes/" title="Release Notes v3" class="md-nav__link">
      Release Notes v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-3/" title="Migration Guide v3" class="md-nav__link">
      Migration Guide v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-2/" title="Migration Guide v2" class="md-nav__link">
      Migration Guide v2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../feature-comparison/" title="Feature comparison" class="md-nav__link">
      Feature comparison
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-soundness-compiling-the-recipe-in-a-test" title="Testing Recipes for Soundness: Compiling the Recipe in a Test" class="md-nav__link">
    Testing Recipes for Soundness: Compiling the Recipe in a Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-correctness-mocking-interaction-implementations" title="Testing Recipes for Correctness: Mocking Interaction Implementations" class="md-nav__link">
    Testing Recipes for Correctness: Mocking Interaction Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-interaction-implementations-with-mockito" title="Mocking Interaction Implementations with Mockito" class="md-nav__link">
    Mocking Interaction Implementations with Mockito
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-individual-implementations" title="Testing Individual Implementations" class="md-nav__link">
    Testing Individual Implementations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ing-bank/baker/edit/master/docs/sections/development-life-cycle/test.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="test">Test</h1>
<p>The Baker model already enforces separation and decoupling between parts of your system, which eases testability, it 
presents a model that divides units of code into modularized sections, more specifically, it provides a clear distinction
between business logic and implementation through the <code>Recipe</code> and <code>InteractionImplementations</code>, and independence between 
<code>Interactions</code>, since every <code>Interaction</code> should only depend on the input. </p>
<p>We present the layers of testing when using Baker, and how to write tests for such layers, use them as necessary.</p>
<h2 id="testing-recipes-for-soundness-compiling-the-recipe-in-a-test">Testing Recipes for Soundness: Compiling the Recipe in a Test</h2>
<p>First, one important notice is that currently Baker does not check at compile time the soundness of your Recipe (if your
Recipe makes any sense), but it does so when compiling it with the <code>RecipeCompiler.compileRecipe(recipe)</code> API. Errors are 
thrown in the form of exceptions describing the issue. So a simple unit test that simply compiles your <code>Recipe</code> is essential.</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">WebshopRecipeSpec</span> <span class="k">extends</span> <span class="nc">FlatSpec</span> <span class="k">with</span> <span class="nc">Matchers</span> <span class="o">{</span>

  <span class="s">&quot;The WebshopRecipe&quot;</span> <span class="n">should</span> <span class="s">&quot;compile the recipe without errors&quot;</span> <span class="n">in</span> <span class="o">{</span>
    <span class="nc">RecipeCompiler</span><span class="o">.</span><span class="n">compileRecipe</span><span class="o">(</span><span class="nc">WebshopRecipe</span><span class="o">.</span><span class="n">recipe</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">JWebshopRecipeTests</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">shouldCompileTheRecipeWithoutIssues</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RecipeCompiler</span><span class="o">.</span><span class="n">compileRecipe</span><span class="o">(</span><span class="nc">JWebshopRecipe</span><span class="o">.</span><span class="n">recipe</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
</div>
<h2 id="testing-recipes-for-correctness-mocking-interaction-implementations">Testing Recipes for Correctness: Mocking Interaction Implementations</h2>
<p>The next layer is to test that the Recipe actually does what you expect it to do at the business logic level <strong>independently</strong>
of the underlying implementations. One way of doing so is by providing <code>InteractionImplementations</code> that behave as expected
according to a testing scenario. </p>
<p>On the next example we will:</p>
<ol>
<li>Create a new local instance of baker.</li>
<li>Setup mocked interaction instances that behave according to your desired test scenario.</li>
<li>Wire the recipe and implementations to fire sensory events according to your desired test scenario.</li>
<li>Inspect the recipe instance state.</li>
<li>Assert expectations on the state and/or the sensory event results.</li>
</ol>
<p><em>Note: Take into consideration the asynchronous nature of Baker, some times the easiest is to use <code>fireAndResolveWhenCompleted</code>
that will resolve when a sensory event has completely finished affecting the state of the recipe instance.</em></p>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="cm">/** Interface used to mock the ReserveItems interaction using the reflection API. */</span>
<span class="k">trait</span> <span class="nc">ReserveItems</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">WebshopRecipeReflection.ReserveItemsOutput</span><span class="o">]</span>
<span class="o">}</span>

<span class="cm">/** Mock of the ReserveItems interaction. */</span>
<span class="k">class</span> <span class="nc">ReserveItemsMock</span> <span class="k">extends</span> <span class="nc">ReserveItems</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">WebshopRecipeReflection.ReserveItemsOutput</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">ItemsReserved</span><span class="o">(</span><span class="n">items</span><span class="o">))</span>
<span class="o">}</span>

<span class="s">&quot;The Webshop Recipe&quot;</span> <span class="n">should</span> <span class="s">&quot;reserve items in happy conditions&quot;</span> <span class="n">in</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;baker-webshop-system&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">materializer</span><span class="k">:</span> <span class="kt">Materializer</span> <span class="o">=</span> <span class="nc">ActorMaterializer</span><span class="o">()(</span><span class="n">system</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">baker</span><span class="k">:</span> <span class="kt">Baker</span> <span class="o">=</span> <span class="nc">Baker</span><span class="o">.</span><span class="n">akkaLocalDefault</span><span class="o">(</span><span class="n">system</span><span class="o">,</span> <span class="n">materializer</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">compiled</span> <span class="k">=</span> <span class="nc">RecipeCompiler</span><span class="o">.</span><span class="n">compileRecipe</span><span class="o">(</span><span class="nc">WebshopRecipe</span><span class="o">.</span><span class="n">recipe</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">recipeInstanceId</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">UUID</span><span class="o">.</span><span class="n">randomUUID</span><span class="o">().</span><span class="n">toString</span>

  <span class="k">val</span> <span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;order-id&quot;</span>
  <span class="k">val</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">,</span> <span class="s">&quot;item2&quot;</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">orderPlaced</span> <span class="k">=</span> <span class="nc">EventInstance</span>
    <span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">OrderPlaced</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">items</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">paymentMade</span> <span class="k">=</span> <span class="nc">EventInstance</span>
    <span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">PaymentMade</span><span class="o">())</span>

  <span class="k">val</span> <span class="n">reserveItemsInstance</span><span class="k">:</span> <span class="kt">InteractionInstance</span> <span class="o">=</span>
    <span class="nc">InteractionInstance</span><span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">ReserveItemsMock</span><span class="o">)</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addInteractionInstace</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
    <span class="n">recipeId</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addRecipe</span><span class="o">(</span><span class="n">compiled</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="n">recipeInstanceId</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span>
      <span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">orderPlaced</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span>
      <span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">paymentMade</span><span class="o">)</span>
    <span class="n">state</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">getRecipeInstanceState</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">)</span>
    <span class="n">provided</span> <span class="k">=</span> <span class="n">state</span>
      <span class="o">.</span><span class="n">ingredients</span>
      <span class="o">.</span><span class="n">find</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_1</span> <span class="o">==</span> <span class="s">&quot;reservedItems&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]])</span>
      <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;, &quot;</span><span class="o">))</span>
      <span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;No reserved items&quot;</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">provided</span> <span class="n">shouldBe</span> <span class="n">items</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;, &quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_1" />
<label for="__tab_2_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kd">static</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">HappyFlowReserveItems</span> <span class="kd">implements</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ReserveItemsOutcome</span> <span class="nf">apply</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ItemsReserved</span><span class="o">(</span><span class="n">items</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldRunSimpleInstance</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">ActorSystem</span> <span class="n">actorSystem</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">);</span>
    <span class="n">Materializer</span> <span class="n">materializer</span> <span class="o">=</span> <span class="n">ActorMaterializer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">);</span>
    <span class="n">Baker</span> <span class="n">baker</span> <span class="o">=</span> <span class="n">Baker</span><span class="o">.</span><span class="na">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
    <span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">);</span>
    <span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item2&quot;</span><span class="o">);</span>

    <span class="n">EventInstance</span> <span class="n">firstOrderPlaced</span> <span class="o">=</span>
            <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">));</span>
    <span class="n">EventInstance</span> <span class="n">paymentMade</span> <span class="o">=</span>
            <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">PaymentMade</span><span class="o">());</span>

    <span class="n">InteractionInstance</span> <span class="n">reserveItemsInstance</span> <span class="o">=</span>
            <span class="n">InteractionInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">HappyFlowReserveItems</span><span class="o">());</span>
    <span class="n">CompiledRecipe</span> <span class="n">compiledRecipe</span> <span class="o">=</span>
            <span class="n">RecipeCompiler</span><span class="o">.</span><span class="na">compileRecipe</span><span class="o">(</span><span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">recipe</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">recipeInstanceId</span> <span class="o">=</span> <span class="s">&quot;first-instance-id&quot;</span><span class="o">;</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baker</span><span class="o">.</span><span class="na">addInteractionInstace</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">addRecipe</span><span class="o">(</span><span class="n">compiledRecipe</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">recipeId</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="n">recipeInstanceId</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">firstOrderPlaced</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">paymentMade</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">getRecipeInstanceState</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenApply</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="na">events</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">EventMoment</span><span class="o">::</span><span class="n">getName</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()));</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockedResult</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

    <span class="k">assert</span><span class="o">(</span><span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;OrderPlaced&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;PaymentMade&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;ItemsReserved&quot;</span><span class="o">));</span>
<span class="o">}</span>
</pre></div></div>
</div>
<p>This test is replicating a full round through a <code>Recipe</code>, the only difference with your normal production code is that 
<code>InteractionInstances</code> are adapted to fit the scenario you want to check, so the objective here is to test that the <code>Recipe</code>
ends on the desired state given a certain order of firing sensory events and that the interaction instances return the
specific data.</p>
<p><em>Note: We recommend you abstract away these scenarios with a function that will run them given different 
interaction instances, so that you can run the same scenario on different environments, like when you want to do a E2E
on a test environment.</em></p>
<h2 id="mocking-interaction-implementations-with-mockito">Mocking Interaction Implementations with Mockito</h2>
<p>Baker supports <code>InteractionInstances</code> that are <a href="https://site.mockito.org/">mockito</a> mocks, this will give you the added 
semantics of Mockito, like verifying that the interaction instance was called, or even called with the expected data.</p>
<div class="superfences-tabs">
<input name="__tabs_3" type="radio" id="__tab_3_0" checked="checked" />
<label for="__tab_3_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">trait</span> <span class="nc">ReserveItems</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">WebshopRecipeReflection.ReserveItemsOutput</span><span class="o">]</span>
<span class="o">}</span>


<span class="s">&quot;The Webshop Recipe&quot;</span> <span class="n">should</span> <span class="s">&quot;reserve items in happy conditions (mockito)&quot;</span> <span class="n">in</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;baker-webshop-system&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">materializer</span><span class="k">:</span> <span class="kt">Materializer</span> <span class="o">=</span> <span class="nc">ActorMaterializer</span><span class="o">()(</span><span class="n">system</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">baker</span><span class="k">:</span> <span class="kt">Baker</span> <span class="o">=</span> <span class="nc">Baker</span><span class="o">.</span><span class="n">akkaLocalDefault</span><span class="o">(</span><span class="n">system</span><span class="o">,</span> <span class="n">materializer</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">compiled</span> <span class="k">=</span> <span class="nc">RecipeCompiler</span><span class="o">.</span><span class="n">compileRecipe</span><span class="o">(</span><span class="nc">WebshopRecipe</span><span class="o">.</span><span class="n">recipe</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">recipeInstanceId</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">UUID</span><span class="o">.</span><span class="n">randomUUID</span><span class="o">().</span><span class="n">toString</span>

  <span class="k">val</span> <span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;order-id&quot;</span>
  <span class="k">val</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">,</span> <span class="s">&quot;item2&quot;</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">orderPlaced</span> <span class="k">=</span> <span class="nc">EventInstance</span>
    <span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">OrderPlaced</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">items</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">paymentMade</span> <span class="k">=</span> <span class="nc">EventInstance</span>
    <span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">PaymentMade</span><span class="o">())</span>

  <span class="c1">// The ReserveItems interaction being mocked by Mockito</span>
  <span class="k">val</span> <span class="n">mockedReserveItems</span><span class="k">:</span> <span class="kt">ReserveItems</span> <span class="o">=</span> <span class="n">mock</span><span class="o">[</span><span class="kt">ReserveItems</span><span class="o">]</span>
  <span class="k">val</span> <span class="n">reserveItemsInstance</span><span class="k">:</span> <span class="kt">InteractionInstance</span> <span class="o">=</span>
    <span class="nc">InteractionInstance</span><span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="n">mockedReserveItems</span><span class="o">)</span>

  <span class="n">when</span><span class="o">(</span><span class="n">mockedReserveItems</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">items</span><span class="o">))</span>
    <span class="o">.</span><span class="n">thenReturn</span><span class="o">(</span><span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">ItemsReserved</span><span class="o">(</span><span class="n">items</span><span class="o">)))</span>

  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addInteractionInstace</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
    <span class="n">recipeId</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addRecipe</span><span class="o">(</span><span class="n">compiled</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="n">recipeInstanceId</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span>
      <span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">orderPlaced</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span>
      <span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">paymentMade</span><span class="o">)</span>
    <span class="n">state</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">getRecipeInstanceState</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">)</span>
    <span class="n">provided</span> <span class="k">=</span> <span class="n">state</span>
      <span class="o">.</span><span class="n">ingredients</span>
      <span class="o">.</span><span class="n">find</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_1</span> <span class="o">==</span> <span class="s">&quot;reservedItems&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]])</span>
      <span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;, &quot;</span><span class="o">))</span>
      <span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;No reserved items&quot;</span><span class="o">)</span>

    <span class="c1">// Verify that the mock was called with the expected data</span>
    <span class="k">_</span> <span class="k">=</span> <span class="n">verify</span><span class="o">(</span><span class="n">mockedReserveItems</span><span class="o">).</span><span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">items</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">provided</span> <span class="n">shouldBe</span> <span class="n">items</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;, &quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_1" />
<label for="__tab_3_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import static</span> <span class="nn">org.mockito.Mockito.*</span><span class="o">;</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldRunSimpleInstanceMockitoSample</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">ActorSystem</span> <span class="n">actorSystem</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">);</span>
    <span class="n">Materializer</span> <span class="n">materializer</span> <span class="o">=</span> <span class="n">ActorMaterializer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">);</span>
    <span class="n">Baker</span> <span class="n">baker</span> <span class="o">=</span> <span class="n">Baker</span><span class="o">.</span><span class="na">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
    <span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">);</span>
    <span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item2&quot;</span><span class="o">);</span>

    <span class="n">EventInstance</span> <span class="n">firstOrderPlaced</span> <span class="o">=</span>
            <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">));</span>
    <span class="n">EventInstance</span> <span class="n">paymentMade</span> <span class="o">=</span>
            <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">PaymentMade</span><span class="o">());</span>

    <span class="c1">// The ReserveItems interaction being mocked by Mockito</span>
    <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span> <span class="n">reserveItemsMock</span> <span class="o">=</span>
            <span class="n">mock</span><span class="o">(</span><span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">InteractionInstance</span> <span class="n">reserveItemsInstance</span> <span class="o">=</span>
            <span class="n">InteractionInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">reserveItemsMock</span><span class="o">);</span>
    <span class="n">CompiledRecipe</span> <span class="n">compiledRecipe</span> <span class="o">=</span>
            <span class="n">RecipeCompiler</span><span class="o">.</span><span class="na">compileRecipe</span><span class="o">(</span><span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">recipe</span><span class="o">);</span>

    <span class="c1">// Add input expectations and their returned event instances</span>
    <span class="n">when</span><span class="o">(</span><span class="n">reserveItemsMock</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span>
            <span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span><span class="o">.</span><span class="na">ItemsReserved</span><span class="o">(</span><span class="n">items</span><span class="o">));</span>

    <span class="n">String</span> <span class="n">recipeInstanceId</span> <span class="o">=</span> <span class="s">&quot;first-instance-id&quot;</span><span class="o">;</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baker</span><span class="o">.</span><span class="na">addInteractionInstace</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">addRecipe</span><span class="o">(</span><span class="n">compiledRecipe</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">recipeId</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="n">recipeInstanceId</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">firstOrderPlaced</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">paymentMade</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">getRecipeInstanceState</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">))</span>
            <span class="o">.</span><span class="na">thenApply</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="na">events</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">EventMoment</span><span class="o">::</span><span class="n">getName</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()));</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockedResult</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>

    <span class="c1">// Verify that the mock was called with the expected data</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">reserveItemsMock</span><span class="o">).</span><span class="na">apply</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">);</span>

    <span class="k">assert</span><span class="o">(</span><span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;OrderPlaced&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;PaymentMade&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;ItemsReserved&quot;</span><span class="o">));</span>
<span class="o">}</span>
</pre></div></div>
</div>
<h2 id="testing-individual-implementations">Testing Individual Implementations</h2>
<p>The final layer is to individually test your implementations, which will resemble your normal e2e tests, interconnectivity 
tests, or unit tests which mock the dependencies. If we put a code example here it would be more of a tutorial on how to 
generally test code than Baker, which is a good argument to show that Baker si all about decoupling your code and automatically
orchestrate it through distributed boundaries.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../bake-fire-events-and-inquiry/" title="Bake, Fire Events and Inquiry" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Bake, Fire Events and Inquiry
              </span>
            </div>
          </a>
        
        
          <a href="../configure/" title="Configure" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configure
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>