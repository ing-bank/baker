



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Main Abstractions - Baker</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/ing.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#main-abstractions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Baker" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Baker
            </span>
            <span class="md-header-nav__topic">
              
                Main Abstractions
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Baker" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Baker
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Development Life Cycle
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Development Life Cycle
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/design-a-recipe/" title="Design a Recipe" class="md-nav__link">
      Design a Recipe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/use-visualizations/" title="Use Visualizations" class="md-nav__link">
      Use Visualizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/implement-interactions/" title="Implement Interactions" class="md-nav__link">
      Implement Interactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/bake-fire-events-and-inquiry/" title="Bake, Fire Events and Inquiry" class="md-nav__link">
      Bake, Fire Events and Inquiry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/test/" title="Test" class="md-nav__link">
      Test
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/configure/" title="Configure" class="md-nav__link">
      Configure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/monitor/" title="Monitor" class="md-nav__link">
      Monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development-life-cycle/resolve-failed-recipe-instances/" title="Resolve Failed Recipes" class="md-nav__link">
      Resolve Failed Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Main Abstractions
      </label>
    
    <a href="./" title="Main Abstractions" class="md-nav__link md-nav__link--active">
      Main Abstractions
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#type-and-value" title="Type and Value" class="md-nav__link">
    Type and Value
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingredient-and-ingredientinstance" title="Ingredient and IngredientInstance" class="md-nav__link">
    Ingredient and IngredientInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-and-eventinstance" title="Event and EventInstance" class="md-nav__link">
    Event and EventInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interaction-and-interactioninstance" title="Interaction and InteractionInstance" class="md-nav__link">
    Interaction and InteractionInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipe-and-recipeinstance" title="Recipe and RecipeInstance" class="md-nav__link">
    Recipe and RecipeInstance
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../execution-semantics/" title="Execution Semantics" class="md-nav__link">
      Execution Semantics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../baker-types-and-values/" title="Baker Types and Values" class="md-nav__link">
      Baker Types and Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dsls/" title="Recipe DSLs" class="md-nav__link">
      Recipe DSLs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../runtime/" title="The Akka Based Runtime" class="md-nav__link">
      The Akka Based Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../event-listener/" title="Event Listener" class="md-nav__link">
      Event Listener
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stores/" title="Event Stores and Cluster Configuration" class="md-nav__link">
      Event Stores and Cluster Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Versions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Versions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-3/" title="Migration Guide v3" class="md-nav__link">
      Migration Guide v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-2/" title="Migration Guide v2" class="md-nav__link">
      Migration Guide v2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../feature-comparison/" title="Feature comparison" class="md-nav__link">
      Feature comparison
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#type-and-value" title="Type and Value" class="md-nav__link">
    Type and Value
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingredient-and-ingredientinstance" title="Ingredient and IngredientInstance" class="md-nav__link">
    Ingredient and IngredientInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-and-eventinstance" title="Event and EventInstance" class="md-nav__link">
    Event and EventInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interaction-and-interactioninstance" title="Interaction and InteractionInstance" class="md-nav__link">
    Interaction and InteractionInstance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipe-and-recipeinstance" title="Recipe and RecipeInstance" class="md-nav__link">
    Recipe and RecipeInstance
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ing-bank/baker/edit/master/docs/sections/reference/main-abstractions.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="main-abstractions">Main Abstractions</h1>
<p>Baker makes a strong division between the specification of your business process and the runtime implementations.</p>
<table>
<thead>
<tr>
<th>Specification</th>
<th>Runtime</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Type</code></td>
<td><code>Value</code></td>
</tr>
<tr>
<td><code>Ingredient</code></td>
<td><code>IngredientInstance</code></td>
</tr>
<tr>
<td><code>Event</code></td>
<td><code>EventInstance</code></td>
</tr>
<tr>
<td><code>Interaction</code></td>
<td><code>InteractionInstance</code></td>
</tr>
<tr>
<td><code>Recipe</code></td>
<td><code>RecipeInstance</code></td>
</tr>
</tbody>
</table>
<p>The first four are used to create <code>Recipe</code>s which serve as "blueprints" of your process. In the Baker
runtime they are used within <code>RecipeInstance</code>s, which are created from a <code>Recipe</code> specification to execute the flow of 
your process.</p>
<h2 id="type-and-value">Type and Value</h2>
<p>Because of the distributed nature of Baker and how the runtime works, we need to have serializable types and values to 
transfer recipes and data between nodes and to match over such data, that is why we implemented a type system on top of Scala.
They help not just to model your domain, but also for Baker to identify when to execute interactions. </p>
<p>If you are using all of our reflection APIs then you will not use them directly, but it is good to know of their 
existence.</p>
<p>Full documentation about the type system can be found <a href="../../reference/baker-types-and-values/">here</a>.</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">com.ing.baker.types._</span>

<span class="k">val</span> <span class="n">data</span><span class="k">:</span> <span class="o">(</span><span class="kt">Type</span><span class="o">,</span> <span class="kt">Value</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="nc">Int32</span><span class="o">,</span> <span class="nc">PrimitiveValue</span><span class="o">(</span><span class="mi">42</span><span class="o">))</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">com.ing.baker.types.*</span><span class="o">;</span>

<span class="n">Type</span> <span class="n">dataType</span> <span class="o">=</span> <span class="n">Int32$</span><span class="o">.</span><span class="na">MODULE$</span><span class="o">;</span>
<span class="n">Value</span> <span class="n">dataValue</span> <span class="o">=</span> <span class="n">PrimitiveValue</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
</pre></div></div>
</div>
<h2 id="ingredient-and-ingredientinstance">Ingredient and IngredientInstance</h2>
<p><code>Ingredients</code> are containers for the data in your process. This data is <strong>immutable</strong>, which means that it can only be created and never 
changes in the process. There is <strong>no subtyping</strong>, nor hierarchy. <code>Ingredients</code> are carried through your process 
with <code>Events</code>, and are inputs for <code>Interactions</code>.</p>
<p>For a <code>Recipe</code> there exist <code>Ingredients</code> which are a name and a <code>Type</code>, they are used to model the data of your process.</p>
<p>For a <code>RecipeInstance</code> there exist <code>IngredientInstance</code>s, which are a name and a <code>Value</code>, they are used to move data 
through your process. </p>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.Ingredient</span>

<span class="k">val</span> <span class="nc">OrderId</span><span class="k">:</span> <span class="kt">Ingredient</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;orderId&quot;</span><span class="o">)</span>


<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.IngredientInstance</span>

<span class="k">val</span> <span class="n">orderIdInstance</span><span class="k">:</span> <span class="kt">IngredientInstance</span> <span class="o">=</span> 
    <span class="nc">IngredientInstance</span><span class="o">(</span><span class="s">&quot;orderId&quot;</span><span class="o">,</span> <span class="nc">PrimitiveValue</span><span class="o">(</span><span class="s">&quot;uuid-123456789&quot;</span><span class="o">))</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_1" />
<label for="__tab_2_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1">// In Java, Ingredients are extracted from a class </span>
<span class="c1">// representing an Event by using java reflection.</span>
<span class="c1">// See the full example at the &quot;Recipe and RecipeInstance&quot; section</span>
</pre></div></div>
</div>
<h2 id="event-and-eventinstance">Event and EventInstance</h2>
<p><code>Events</code> represent happenings in your process that might carry <code>Ingredients</code>, they represent an "asynchronous boundary",
they are always either output from <code>Interactions</code> or a special case called <code>SensoryEvent</code>s; we call sensory events to the 
events that come from "outside" of your recipe and are normally used to start your process.</p>
<p>For a <code>Recipe</code> there exist <code>Events</code> which are a name, a set of <code>Ingredients</code> and a maximum amount of firings; the 
<code>maxFiringLimit</code> is a property which describes the number of times an event is allowed to fire, this is later on
enforced by the Baker runtime. To know more about firing limits and all the other configurable properties, please 
refer to the <a href="../../reference/dsls/">DSLs documentation</a>.</p>
<p>For a <code>RecipeInstance</code> there exist <code>EventInstance</code>s which are data structures that must match their interface equivalent
declared as <code>Events</code> on the <code>Recipe</code>. They notify a baker <code>RecipeInstance</code> of an actual happening and may carry <code>Ingredient</code>
values; the baker <code>RecipeInstance</code> will then use available <code>Ingredients</code> to execute <code>InteractionInstance</code>s.</p>
<p><strong>Note: Names of sensory <code>Event</code> and <code>EventInstance</code> must match, so that Baker can correctly execute your process flow.</strong></p>
<div class="superfences-tabs">
<input name="__tabs_3" type="radio" id="__tab_3_0" checked="checked" />
<label for="__tab_3_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="cm">/** Event */</span>
<span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.Event</span>
<span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.Ingredient</span>

<span class="k">val</span> <span class="nc">OrderPlaced</span><span class="k">:</span> <span class="kt">Event</span> <span class="o">=</span> <span class="nc">Event</span><span class="o">(</span>
  <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;OrderPlaced&quot;</span><span class="o">,</span>
  <span class="n">providedIngredients</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;orderId&quot;</span><span class="o">),</span>
    <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]](</span><span class="s">&quot;items&quot;</span><span class="o">)</span>
  <span class="o">),</span>
  <span class="n">maxFiringLimit</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">)</span>

<span class="cm">/** EventInstance */</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.EventInstance</span>
<span class="k">import</span> <span class="nn">com.ing.baker.types.</span><span class="o">{</span><span class="nc">PrimitiveValue</span><span class="o">,</span> <span class="nc">ListValue</span><span class="o">}</span>

<span class="k">val</span> <span class="n">firstOrderPlaced</span><span class="k">:</span> <span class="kt">EventInstance</span> <span class="o">=</span> <span class="nc">EventInstance</span><span class="o">(</span>
  <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;OrderPlaced&quot;</span><span class="o">,</span>
  <span class="n">providedIngredients</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span>
    <span class="s">&quot;orderId&quot;</span> <span class="o">-&gt;</span> <span class="nc">PrimitiveValue</span><span class="o">(</span><span class="s">&quot;uuid-0123456789&quot;</span><span class="o">),</span>
    <span class="s">&quot;items&quot;</span> <span class="o">-&gt;</span> <span class="nc">ListValue</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">PrimitiveValue</span><span class="o">(</span><span class="s">&quot;item1-id&quot;</span><span class="o">),</span> <span class="nc">PrimitiveValue</span><span class="o">(</span><span class="s">&quot;item2-id&quot;</span><span class="o">)))</span>
  <span class="o">)</span>
<span class="o">)</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_1" />
<label for="__tab_3_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1">// In Java, Events and EventInstances are extracted from a </span>
<span class="c1">// class by using java reflection.</span>
<span class="c1">// Please check the full recipe example below on the </span>
<span class="c1">// Recipe and RecipeInstance subsection</span>

<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.EventInstance</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">OrderPlaced</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OrderPlaced</span><span class="o">(</span><span class="n">String</span> <span class="n">orderId</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderId</span> <span class="o">=</span> <span class="n">orderId</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item2&quot;</span><span class="o">);</span>
<span class="n">OrderPlaced</span> <span class="n">order1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrderPlaced</span><span class="o">(</span><span class="s">&quot;uuid-0123456789&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">);</span>
<span class="n">EventInstance</span> <span class="n">order1Event</span> <span class="o">=</span> <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">order1</span><span class="o">);</span>
</pre></div></div>
</div>
<p>To fire a <code>SensoryEvent</code> use the <code>bakerRuntime.fireEvent(recipeInstanceId, event)</code> API variations, 
after creating the baker runtime, adding your recipe to the runtime and <code>baking</code> a <code>RecipeInstance</code>. For full 
documentation on this please refer to the <a href="../../reference/runtime/">runtime documentation</a>.</p>
<div class="superfences-tabs">
<input name="__tabs_4" type="radio" id="__tab_4_0" checked="checked" />
<label for="__tab_4_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.</span><span class="o">{</span><span class="nc">ActorMaterializer</span><span class="o">,</span> <span class="nc">Materializer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.common.EventResult</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.</span><span class="o">{</span><span class="nc">Baker</span><span class="o">,</span> <span class="nc">EventInstance</span><span class="o">}</span>

<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">actorSystem</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span>
    <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span><span class="k">:</span> <span class="kt">Materializer</span> <span class="o">=</span>
    <span class="nc">ActorMaterializer</span><span class="o">()</span>
<span class="k">val</span> <span class="n">baker</span><span class="k">:</span> <span class="kt">Baker</span> <span class="o">=</span> <span class="nc">Baker</span><span class="o">.</span><span class="n">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">)</span>

<span class="c1">// This example is using the reflection API `EventInstance.unsafeFrom`</span>
<span class="k">val</span> <span class="nc">FirstOrderPlaced</span><span class="k">:</span> <span class="kt">EventInstance</span> <span class="o">=</span> <span class="nc">EventInstance</span>
    <span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="nc">List</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">,</span> <span class="s">&quot;item2&quot;</span><span class="o">)))</span>
<span class="k">val</span> <span class="n">recipeInstanceId</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;recipe id from previously baked recipe instance&quot;</span>

<span class="k">val</span> <span class="n">result</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">EventResult</span><span class="o">]</span> <span class="k">=</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="nc">FirstOrderPlaced</span><span class="o">)</span>
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_1" />
<label for="__tab_4_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">akka.actor.ActorSystem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.ActorMaterializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.Materializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.Baker</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.EventInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.EventResult</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span><span class="o">;</span>

<span class="n">ActorSystem</span> <span class="n">actorSystem</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">);</span>
<span class="n">Materializer</span> <span class="n">materializer</span> <span class="o">=</span> <span class="n">ActorMaterializer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">);</span>
<span class="n">Baker</span> <span class="n">baker</span> <span class="o">=</span> <span class="n">Baker</span><span class="o">.</span><span class="na">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">);</span>

<span class="n">String</span> <span class="n">recipeInstanceId</span> <span class="o">=</span> <span class="s">&quot;recipe id from previously baked recipe instance&quot;</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item2&quot;</span><span class="o">);</span>
<span class="n">EventInstance</span> <span class="n">firstOrderPlaced</span> <span class="o">=</span> 
        <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">));</span>

<span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">EventResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">firstOrderPlaced</span><span class="o">);</span>
</pre></div></div>
</div>
<h2 id="interaction-and-interactioninstance">Interaction and InteractionInstance</h2>
<p>An interaction resemblance a function, it requires input (<code>Ingredients</code>) and provides output (<code>Events</code>). Within this
contract it may do anything. For example:</p>
<ul>
<li>Query a microservice</li>
<li>Send messages to an event broker like Kafka</li>
<li>Await for a message from an event broker</li>
<li>Generate a file</li>
<li>Do transformations on the ingredients (we like to call these interactions <code>Sieves</code>)</li>
</ul>
<p>For a <code>Recipe</code> there exist <code>Interactions</code> which are a name, a sequence of <code>Ingredients</code> describing all the input (all of),
and a sequence of <code>Events</code> describing the <em>possible</em> event outputs (one of). At the recipe level there are several more 
specifics that can be configured, like requiring events without ingredients, adding predefined ingredients, overriding
ingredient names, or handling unexpected failure, for these please refer to the <a href="../../reference/dsls/">DSLs documentation</a>.</p>
<p>For a <code>RecipeInstance</code> there exist <code>InteractionInstance</code>s which are a name, an input type description, and an implementation
of a method/function that will be called when the interaction is executed. The input name and the input type description 
is used by the Baker runtime to find the correct <code>InteractionImplementation</code> to execute when the <code>Ingredients</code> are available.</p>
<p><strong>Note: Names of sensory <code>Event</code> and <code>EventInstance</code> must match, so that Baker can correctly execute your process flow.</strong></p>
<p><strong>Note: For asynchronous programming, the Scala DSL <code>InteractionInstance</code> can return a <code>Future[A]</code> and the Java DSL can
return a <code>CompletableFuture&lt;A&gt;</code>, and the Baker runtime will handle the async results of the instances.</strong></p>
<div class="superfences-tabs">
<input name="__tabs_5" type="radio" id="__tab_5_0" checked="checked" />
<label for="__tab_5_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="cm">/** Interaction */</span>
<span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.</span><span class="o">{</span><span class="nc">Event</span><span class="o">,</span> <span class="nc">Ingredient</span><span class="o">,</span> <span class="nc">Interaction</span><span class="o">}</span>

<span class="k">val</span> <span class="nc">ReserveItems</span><span class="k">:</span> <span class="kt">Interaction</span> <span class="o">=</span> <span class="nc">Interaction</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;ReserveItems&quot;</span><span class="o">,</span>
    <span class="n">inputIngredients</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
        <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;orderId&quot;</span><span class="o">),</span>
        <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]](</span><span class="s">&quot;items&quot;</span><span class="o">)</span>
    <span class="o">),</span>
    <span class="n">output</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
        <span class="nc">Events</span><span class="o">.</span><span class="nc">OrderHadUnavailableItems</span><span class="o">,</span>
        <span class="nc">Events</span><span class="o">.</span><span class="nc">ItemsReserved</span>
    <span class="o">)</span>
<span class="o">)</span>

<span class="cm">/** InteractionInstance */</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.</span><span class="o">{</span><span class="nc">EventInstance</span><span class="o">,</span> <span class="nc">IngredientInstance</span><span class="o">,</span> <span class="nc">InteractionInstance</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.ing.baker.types.</span><span class="o">{</span><span class="nc">CharArray</span><span class="o">,</span> <span class="nc">ListType</span><span class="o">,</span> <span class="nc">ListValue</span><span class="o">,</span> <span class="nc">PrimitiveValue</span><span class="o">}</span>

<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>

<span class="k">val</span> <span class="nc">ReserveItemsInstance</span> <span class="k">=</span> <span class="nc">InteractionInstance</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="nc">ReserveItems</span><span class="o">.</span><span class="n">name</span><span class="o">,</span>
    <span class="n">input</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="nc">CharArray</span><span class="o">,</span> <span class="nc">ListType</span><span class="o">(</span><span class="nc">CharArray</span><span class="o">))</span>
    <span class="n">run</span> <span class="k">=</span> <span class="n">handleReserveItems</span>
<span class="o">)</span>

<span class="k">def</span> <span class="n">handleReserveItems</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">IngredientInstance</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">EventInstance</span><span class="o">]]</span> <span class="k">=</span> <span class="o">???</span>
    <span class="c1">// ListValue and PrimitiveValue are used in the body</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_1" />
<label for="__tab_5_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="cm">/** Interaction */</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.annotations.FiresEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.annotations.RequiresIngredient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.javadsl.Interaction</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReserveItems</span> <span class="kd">extends</span> <span class="n">Interaction</span> <span class="o">{</span>

    <span class="kd">interface</span> <span class="nc">ReserveItemsOutcome</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">OrderHadUnavailableItems</span> <span class="kd">implements</span> <span class="n">ReserveItemsOutcome</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unavailableItems</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">OrderHadUnavailableItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unavailableItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">unavailableItems</span> <span class="o">=</span> <span class="n">unavailableItems</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">ItemsReserved</span> <span class="kd">implements</span> <span class="n">ReserveItemsOutcome</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">reservedItems</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ItemsReserved</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">reservedItems</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">reservedItems</span> <span class="o">=</span> <span class="n">reservedItems</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Annotations are needed for wiring ingredients and validating events.</span>
    <span class="nd">@FiresEvent</span><span class="o">(</span><span class="n">oneOf</span> <span class="o">=</span> <span class="o">{</span><span class="n">OrderHadUnavailableItems</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">ItemsReserved</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
    <span class="c1">// The name of the method must be &quot;apply&quot; for the reflection API to work.</span>
    <span class="c1">// This method can also return a `CompletableFuture&lt;ReserveItemsOutcome&gt;` for asynchronous programming.</span>
    <span class="n">ReserveItemsOutcome</span> <span class="nf">apply</span><span class="o">(</span><span class="nd">@RequiresIngredient</span><span class="o">(</span><span class="s">&quot;orderId&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequiresIngredient</span><span class="o">(</span><span class="s">&quot;items&quot;</span><span class="o">)</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/** InteractionInstance */</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.InteractionInstance</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReserveItems</span> <span class="kd">implements</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">ReserveItemsOutcome</span> <span class="nf">apply</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">ReserveItems</span><span class="o">.</span><span class="na">ItemsReserved</span><span class="o">(</span><span class="n">items</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_2" />
<label for="__tab_5_2">Scala (Reflection API)</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="c1">// See the DSLs documentation for more on the reflection API</span>
<span class="k">trait</span> <span class="nc">ReserveItems</span> <span class="o">{</span>

    <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">WebshopRecipeReflection.ReserveItemsOutput</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ReserveItemsInstance</span> <span class="k">extends</span> <span class="nc">ReserveItems</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">WebshopRecipeReflection.ReserveItemsOutput</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>

    <span class="c1">// Http call to the Warehouse service</span>
    <span class="k">val</span> <span class="n">response</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>, <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]]]</span> <span class="k">=</span>
    <span class="c1">// This is mocked for the sake of the example</span>
      <span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="nc">Right</span><span class="o">(</span><span class="n">items</span><span class="o">))</span>

    <span class="c1">// Build an event instance that Baker understands</span>
    <span class="n">response</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">unavailableItems</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">OrderHadUnavailableItems</span><span class="o">(</span><span class="n">unavailableItems</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">reservedItems</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">ItemsReserved</span><span class="o">(</span><span class="n">reservedItems</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">reserveItemsInstance</span><span class="k">:</span> <span class="kt">InteractionInstance</span> <span class="o">=</span>
  <span class="nc">InteractionInstance</span><span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="k">new</span> <span class="nc">ReserveItemsInstance</span><span class="o">)</span>
</pre></div></div>
</div>
<p>After creating your <code>InteractionInstance</code>s, you need to add them to the baker runtime so that Baker can match them to the <code>Interactions</code>
of your <code>Recipe</code> and call them when needed.</p>
<div class="superfences-tabs">
<input name="__tabs_6" type="radio" id="__tab_6_0" checked="checked" />
<label for="__tab_6_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.</span><span class="o">{</span><span class="nc">ActorMaterializer</span><span class="o">,</span> <span class="nc">Materializer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.Baker</span>

<span class="k">import</span> <span class="nn">scala.concurrent.Future</span>

<span class="k">val</span> <span class="n">done</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="n">baker</span><span class="o">.</span><span class="n">addImplementation</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_1" />
<label for="__tab_6_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">akka.actor.ActorSystem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.ActorMaterializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.Materializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.Baker</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">scala.runtime.BoxedUnit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span><span class="o">;</span>

<span class="n">ActorSystem</span> <span class="n">actorSystem</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">);</span>
<span class="n">Materializer</span> <span class="n">materializer</span> <span class="o">=</span> <span class="n">ActorMaterializer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">);</span>
<span class="n">Baker</span> <span class="n">baker</span> <span class="o">=</span> <span class="n">Baker</span><span class="o">.</span><span class="na">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">);</span>

<span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">BoxedUnit</span><span class="o">&gt;</span> <span class="n">done</span> <span class="o">=</span> <span class="n">baker</span><span class="o">.</span><span class="na">addImplementation</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">);</span>
</pre></div></div>
</div>
<h2 id="recipe-and-recipeinstance">Recipe and RecipeInstance</h2>
<p>All you <code>Ingredients</code>, <code>Events</code> and <code>Interactions</code> must be added to a single unit called the <code>Recipe</code>, which works as the
"blueprint" of your precess.</p>
<div class="superfences-tabs">
<input name="__tabs_7" type="radio" id="__tab_7_0" checked="checked" />
<label for="__tab_7_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.Recipe</span>

<span class="k">val</span> <span class="n">recipe</span><span class="k">:</span> <span class="kt">Recipe</span> <span class="o">=</span> <span class="nc">Recipe</span><span class="o">(</span><span class="s">&quot;Webshop&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withSensoryEvents</span><span class="o">(</span>
        <span class="nc">Events</span><span class="o">.</span><span class="nc">OrderPlaced</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="n">withInteractions</span><span class="o">(</span>
        <span class="nc">Interactions</span><span class="o">.</span><span class="nc">ReserveItems</span><span class="o">,</span>
    <span class="o">)</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_1" />
<label for="__tab_7_1">Scala Full Example</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">package</span> <span class="nn">webshop</span>

<span class="k">import</span> <span class="nn">com.ing.baker.recipe.scaladsl.</span><span class="o">{</span><span class="nc">Event</span><span class="o">,</span> <span class="nc">Ingredient</span><span class="o">,</span> <span class="nc">Interaction</span><span class="o">,</span> <span class="nc">Recipe</span><span class="o">}</span>

<span class="k">object</span> <span class="nc">WebshopRecipeReflection</span> <span class="o">{</span>

  <span class="k">case</span> <span class="k">class</span> <span class="nc">OrderPlaced</span><span class="o">(</span><span class="n">orderId</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ReserveItemsOutput</span>

  <span class="k">case</span> <span class="k">class</span> <span class="nc">OrderHadUnavailableItems</span><span class="o">(</span><span class="n">unavailableItems</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">ReserveItemsOutput</span>

  <span class="k">case</span> <span class="k">class</span> <span class="nc">ItemsReserved</span><span class="o">(</span><span class="n">reservedItems</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">ReserveItemsOutput</span>

  <span class="k">val</span> <span class="nc">ReserveItems</span> <span class="k">=</span> <span class="nc">Interaction</span><span class="o">(</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;ReserveItems&quot;</span><span class="o">,</span>
    <span class="n">inputIngredients</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
      <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;orderId&quot;</span><span class="o">),</span>
      <span class="nc">Ingredient</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]](</span><span class="s">&quot;items&quot;</span><span class="o">)</span>
    <span class="o">),</span>
    <span class="n">output</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
      <span class="nc">Event</span><span class="o">[</span><span class="kt">OrderHadUnavailableItems</span><span class="o">],</span>
      <span class="nc">Event</span><span class="o">[</span><span class="kt">ItemsReserved</span><span class="o">]</span>
    <span class="o">)</span>
  <span class="o">)</span>

  <span class="k">val</span> <span class="n">recipe</span><span class="k">:</span> <span class="kt">Recipe</span> <span class="o">=</span> <span class="nc">Recipe</span><span class="o">(</span><span class="s">&quot;Webshop&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withSensoryEvents</span><span class="o">(</span>
      <span class="nc">Event</span><span class="o">[</span><span class="kt">OrderPlaced</span><span class="o">],</span>
      <span class="nc">Event</span><span class="o">[</span><span class="kt">OrderHadUnavailableItems</span><span class="o">],</span>
      <span class="nc">Event</span><span class="o">[</span><span class="kt">ItemsReserved</span><span class="o">]</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="n">withInteractions</span><span class="o">(</span>
      <span class="nc">ReserveItems</span>
    <span class="o">)</span>
<span class="o">}</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_2" />
<label for="__tab_7_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">com.ing.baker.recipe.javadsl.Recipe</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">com.ing.baker.recipe.javadsl.InteractionDescriptor.of</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Recipe</span> <span class="n">recipe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Recipe</span><span class="o">(</span><span class="s">&quot;WebshopRecipe&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withSensoryEvents</span><span class="o">(</span><span class="n">OrderPlaced</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withInteractions</span><span class="o">(</span><span class="n">of</span><span class="o">(</span><span class="n">ReserveItems</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_3" />
<label for="__tab_7_3">Java Full Example</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">webshop</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.annotations.FiresEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.annotations.RequiresIngredient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.javadsl.Interaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.recipe.javadsl.Recipe</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">com.ing.baker.recipe.javadsl.InteractionDescriptor.of</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JWebshopRecipe</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">OrderPlaced</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">orderId</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">OrderPlaced</span><span class="o">(</span><span class="n">String</span> <span class="n">orderId</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">orderId</span> <span class="o">=</span> <span class="n">orderId</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReserveItems</span> <span class="kd">extends</span> <span class="n">Interaction</span> <span class="o">{</span>

        <span class="kd">interface</span> <span class="nc">ReserveItemsOutcome</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="kd">class</span> <span class="nc">OrderHadUnavailableItems</span> <span class="kd">implements</span> <span class="n">ReserveItemsOutcome</span> <span class="o">{</span>

            <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unavailableItems</span><span class="o">;</span>

            <span class="kd">public</span> <span class="nf">OrderHadUnavailableItems</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">unavailableItems</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">unavailableItems</span> <span class="o">=</span> <span class="n">unavailableItems</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">class</span> <span class="nc">ItemsReserved</span> <span class="kd">implements</span> <span class="n">ReserveItemsOutcome</span> <span class="o">{</span>

            <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">reservedItems</span><span class="o">;</span>

            <span class="kd">public</span> <span class="nf">ItemsReserved</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">reservedItems</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">reservedItems</span> <span class="o">=</span> <span class="n">reservedItems</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="nd">@FiresEvent</span><span class="o">(</span><span class="n">oneOf</span> <span class="o">=</span> <span class="o">{</span><span class="n">OrderHadUnavailableItems</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">ItemsReserved</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
        <span class="n">ReserveItemsOutcome</span> <span class="nf">apply</span><span class="o">(</span><span class="nd">@RequiresIngredient</span><span class="o">(</span><span class="s">&quot;orderId&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequiresIngredient</span><span class="o">(</span><span class="s">&quot;items&quot;</span><span class="o">)</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Recipe</span> <span class="n">recipe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Recipe</span><span class="o">(</span><span class="s">&quot;WebshopRecipe&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withSensoryEvents</span><span class="o">(</span><span class="n">OrderPlaced</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withInteractions</span><span class="o">(</span><span class="n">of</span><span class="o">(</span><span class="n">ReserveItems</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
<span class="o">}</span>
</pre></div></div>
</div>
<p>A recipe must be added to a baker runtime so that you can create "bake" a <code>RecipeInstance</code> from it. For that it must be
first "compiled" by using the provided compiler.</p>
<p>Here is a full example of creating a baker runtime, adding the <code>InteractionInstances</code> and the compiled <code>Recipe</code> (order matters
becase baker validates that all recipes have valid implementations when added), and firing an <code>Event</code> that will execute 
the <code>Interaction</code></p>
<div class="superfences-tabs">
<input name="__tabs_8" type="radio" id="__tab_8_0" checked="checked" />
<label for="__tab_8_0">Scala</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.</span><span class="o">{</span><span class="nc">ActorMaterializer</span><span class="o">,</span> <span class="nc">Materializer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.ing.baker.compiler.RecipeCompiler</span>
<span class="k">import</span> <span class="nn">com.ing.baker.il.CompiledRecipe</span>
<span class="k">import</span> <span class="nn">com.ing.baker.runtime.scaladsl.</span><span class="o">{</span><span class="nc">Baker</span><span class="o">,</span> <span class="nc">EventInstance</span><span class="o">}</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">actorSystem</span><span class="k">:</span> <span class="kt">ActorSystem</span> <span class="o">=</span>
    <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">materializer</span><span class="k">:</span> <span class="kt">Materializer</span> <span class="o">=</span>
    <span class="nc">ActorMaterializer</span><span class="o">()</span>
<span class="k">val</span> <span class="n">baker</span><span class="k">:</span> <span class="kt">Baker</span> <span class="o">=</span> <span class="nc">Baker</span><span class="o">.</span><span class="n">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">)</span>

<span class="k">val</span> <span class="n">compiledRecipe</span><span class="k">:</span> <span class="kt">CompiledRecipe</span> <span class="o">=</span> <span class="nc">RecipeCompiler</span><span class="o">.</span><span class="n">compileRecipe</span><span class="o">(</span><span class="nc">WebshopRecipe</span><span class="o">.</span><span class="n">recipe</span><span class="o">)</span>

<span class="k">val</span> <span class="n">program</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addImplementation</span><span class="o">(</span><span class="nc">WebshopInstances</span><span class="o">.</span><span class="nc">ReserveItemsInstance</span><span class="o">)</span>
    <span class="n">recipeId</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">addRecipe</span><span class="o">(</span><span class="n">compiledRecipe</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="s">&quot;first-instance-id&quot;</span><span class="o">)</span>
    <span class="n">firstOrderPlaced</span><span class="k">:</span> <span class="kt">EventInstance</span> <span class="o">=</span>
        <span class="nc">EventInstance</span><span class="o">.</span><span class="n">unsafeFrom</span><span class="o">(</span><span class="nc">WebshopRecipeReflection</span><span class="o">.</span><span class="nc">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="nc">List</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">,</span> <span class="s">&quot;item2&quot;</span><span class="o">)))</span>
    <span class="n">result</span> <span class="k">&lt;-</span> <span class="n">baker</span><span class="o">.</span><span class="n">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="s">&quot;first-instance-id&quot;</span><span class="o">,</span> <span class="n">firstOrderPlaced</span><span class="o">)</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">assert</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">events</span> <span class="o">==</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="nc">WebshopRecipe</span><span class="o">.</span><span class="nc">Events</span><span class="o">.</span><span class="nc">OrderPlaced</span><span class="o">.</span><span class="n">name</span><span class="o">,</span>
    <span class="nc">WebshopRecipe</span><span class="o">.</span><span class="nc">Events</span><span class="o">.</span><span class="nc">ItemsReserved</span><span class="o">.</span><span class="n">name</span>
<span class="o">))</span>
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_1" />
<label for="__tab_8_1">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">akka.actor.ActorSystem</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.ActorMaterializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">akka.stream.Materializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.compiler.RecipeCompiler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.il.CompiledRecipe</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.Baker</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.EventInstance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.EventResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ing.baker.runtime.javadsl.InteractionInstance</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span><span class="o">;</span>


<span class="n">ActorSystem</span> <span class="n">actorSystem</span> <span class="o">=</span> <span class="n">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;WebshopSystem&quot;</span><span class="o">);</span>
<span class="n">Materializer</span> <span class="n">materializer</span> <span class="o">=</span> <span class="n">ActorMaterializer</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">);</span>
<span class="n">Baker</span> <span class="n">baker</span> <span class="o">=</span> <span class="n">Baker</span><span class="o">.</span><span class="na">akkaLocalDefault</span><span class="o">(</span><span class="n">actorSystem</span><span class="o">,</span> <span class="n">materializer</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item1&quot;</span><span class="o">);</span>
<span class="n">items</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;item2&quot;</span><span class="o">);</span>
<span class="n">EventInstance</span> <span class="n">firstOrderPlaced</span> <span class="o">=</span>
        <span class="n">EventInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">OrderPlaced</span><span class="o">(</span><span class="s">&quot;order-uuid&quot;</span><span class="o">,</span> <span class="n">items</span><span class="o">));</span>

<span class="n">InteractionInstance</span> <span class="n">reserveItemsInstance</span> <span class="o">=</span> <span class="n">InteractionInstance</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">new</span> <span class="n">ReserveItems</span><span class="o">());</span>
<span class="n">CompiledRecipe</span> <span class="n">compiledRecipe</span> <span class="o">=</span> <span class="n">RecipeCompiler</span><span class="o">.</span><span class="na">compileRecipe</span><span class="o">(</span><span class="n">JWebshopRecipe</span><span class="o">.</span><span class="na">recipe</span><span class="o">);</span>

<span class="n">String</span> <span class="n">recipeInstanceId</span> <span class="o">=</span> <span class="s">&quot;first-instance-id&quot;</span><span class="o">;</span>
<span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baker</span><span class="o">.</span><span class="na">addImplementation</span><span class="o">(</span><span class="n">reserveItemsInstance</span><span class="o">)</span>
    <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">addRecipe</span><span class="o">(</span><span class="n">compiledRecipe</span><span class="o">))</span>
    <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">recipeId</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">bake</span><span class="o">(</span><span class="n">recipeId</span><span class="o">,</span> <span class="n">recipeInstanceId</span><span class="o">))</span>
    <span class="o">.</span><span class="na">thenCompose</span><span class="o">(</span><span class="n">ignore</span> <span class="o">-&gt;</span> <span class="n">baker</span><span class="o">.</span><span class="na">fireEventAndResolveWhenCompleted</span><span class="o">(</span><span class="n">recipeInstanceId</span><span class="o">,</span> <span class="n">firstOrderPlaced</span><span class="o">))</span>
    <span class="o">.</span><span class="na">thenApply</span><span class="o">(</span><span class="n">EventResult</span><span class="o">::</span><span class="n">events</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockedResult</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
<span class="k">assert</span><span class="o">(</span><span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;OrderPlaced&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">blockedResult</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;ReservedItems&quot;</span><span class="o">));</span>
</pre></div></div>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../development-life-cycle/resolve-failed-recipe-instances/" title="Resolve Failed Recipes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Resolve Failed Recipes
              </span>
            </div>
          </a>
        
        
          <a href="../execution-semantics/" title="Execution Semantics" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Execution Semantics
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>