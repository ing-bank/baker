syntax = "proto2";

import "scalapb/scalapb.proto";

option java_package = "com.ing.baker.runtime.actor.protobuf";
option (scalapb.options) = {
    flat_package: true
};

// wrapper object for 'any' data
message SerializedData {
    optional int32 serializer_id = 1;
    optional string manifest = 2;
    optional bytes data = 3;
}

// Baker type system messages
enum PrimitiveType {
    BOOLEAN = 1;
    BYTE = 2;
    SHORT = 3;
    CHARACTER = 4;
    INTEGER = 5;
    INT = 6;
    LONG = 7;
    FLOAT = 8;
    DOUBLE = 9;
    STRING = 10;
    BIG_DECIMAL_SCALA = 11;
    BIG_DECIMAL_JAVA = 12;
    BIG_INT_SCALA = 13;
    BIG_INT_JAVA = 14;
    BYTE_ARRAY = 15;
    JODA_DATETIME = 16;
    JODA_LOCAL_DATE = 17;
    JODA_LOCAL_DATETIME = 18;
}

message OptionalType {
    optional Type entryType = 1;
}

message ListType {
    optional Type entryType = 1;
}

message RecordField {
    optional string name = 1;
    optional Type type = 2;
}

message RecordType {
    repeated RecordField fields = 1;
}

message MapType {
    optional Type valueType = 1;
}

message EnumType {
    repeated string options = 1;
}

message Type {
    oneof oneof_type {
        PrimitiveType primitive = 1;
        OptionalType optional = 2;
        ListType list = 3;
        RecordType record = 4;
        MapType map = 5;
        EnumType enum = 6;
    }
}
// END -- Baker type system messages


//  DATA (Runtime messages)
message Ingredient {
    optional string name = 1;
    optional SerializedData data = 2;
}

message RuntimeEvent {
    optional string name = 1;
    repeated Ingredient providedIngredients = 2;
}

message ProcessState {
    optional string processId = 1;
    repeated Ingredient ingredients = 2;
}
// END DATA

// DESCRIPTORS (Intermediate Language messages)
message IngredientDescriptor {
    optional string name = 1;
    optional Type type = 2;
}

message EventDescriptor {
    optional string name = 1;
    repeated IngredientDescriptor ingredients = 2;
}

message CompiledRecipe {
    optional string name = 1;
    optional Graph petrinet = 2;
    repeated ProducedToken initialMarking = 3;
    repeated EventDescriptor sensoryEvents = 4;
    repeated string validationErrors = 5;
    optional int64 eventReceivePeriod = 6;
    optional int64 retentionPeriod = 7;
}
// END DESCRIPTORS


// PETRINET
message Edge {
    optional int32 from = 1;
    optional int32 to = 2;
    optional int64 weight = 3;
    optional SerializedData label = 4;
}

message Graph {
    repeated SerializedData nodes = 1;
    repeated Edge edges = 2;
}

message ProducedToken {
    optional int64 place_id = 1;
    optional int64 token_id = 2;
    optional int32 count = 3;
    optional SerializedData token_data = 4;
}

enum PlaceType {
    IngredientPlace = 1;
    InteractionEventOutputPlace = 2;
    FiringLimiterPlace = 3;
    EventPreconditionPlace = 4;
    EventOrPreconditionPlace = 5;
    IntermediatePlace = 6;
    EmptyEventIngredientPlace = 7;
    MultiTransitionPlace = 8;
}

message Place {
    optional string label = 1;
    optional PlaceType placeType = 2;
    optional int32 firingLimiterPlaceMaxLimit = 3;
}

message EventTransition {
    optional EventDescriptor eventDescriptor = 1;
    optional bool isSensoryEvent = 2;
    optional int32 maxFiringLimit = 3;
}

// END PETRINET